<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מחולל דפי עבודה בעברית</title>
    <style>
        body {
            font-family: 'David', 'Arial Hebrew', Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
            color: #333;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #1a73e8;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            font-family: inherit;
            transition: border-color 0.3s;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #1a73e8;
        }
        
        textarea {
            min-height: 200px;
            direction: rtl;
            resize: vertical;
        }
        
        button {
            background: linear-gradient(135deg, #1a73e8, #0d47a1);
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        button:hover {
            background: linear-gradient(135deg, #0d47a1, #1a73e8);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
        }
        
        .example {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 14px;
            white-space: pre-wrap;
            border-right: 4px solid #4caf50;
        }
        
        .instructions {
            background: linear-gradient(135deg, #e8f0fe, #f3e5f5);
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 8px;
            border-right: 5px solid #1a73e8;
        }
        
        .instructions h3 {
            margin-top: 0;
            color: #1a73e8;
            font-size: 1.3em;
        }
        
        .instructions ul {
            margin: 10px 0;
        }
        
        .instructions li {
            margin-bottom: 8px;
            padding-right: 10px;
        }
        
        .hidden {
            display: none;
        }
        
        /* סטיילינג לדף העבודה */
        .worksheet-container {
            background-color: white;
            max-width: 210mm;
            margin: 20px auto;
            padding: 20mm;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border-radius: 8px;
        }
        
        .worksheet-header {
            text-align: center;
            margin-bottom: 20mm;
            border-bottom: 2px solid #333;
            padding-bottom: 10mm;
        }
        
        .worksheet-title {
            font-size: 28px;
            font-weight: bold;
            color: #1a73e8;
            margin-bottom: 10px;
        }
        
        .worksheet-intro {
            background-color: #f0f8ff;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 6px;
            border-right: 4px solid #1a73e8;
        }
        
        .question {
            margin-bottom: 25px;
            page-break-inside: avoid;
            background-color: #fafafa;
            padding: 15px;
            border-radius: 6px;
            border-right: 3px solid #4caf50;
        }
        
        .question-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 10px;
            color: #333;
        }
        
        .blank-line {
            display: inline-block;
            min-width: 120px;
            height: 2px;
            border-bottom: 2px solid #333;
            margin: 0 8px;
            position: relative;
            top: -2px;
        }
        
        .word-bank {
            background-color: #fff3cd;
            padding: 12px;
            margin: 10px 0;
            border-radius: 6px;
            border-right: 4px solid #ffc107;
            font-weight: bold;
        }
        
        .options {
            margin-top: 10px;
        }
        
        .option {
            margin-bottom: 8px;
            padding: 5px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        
        .option-letter {
            font-weight: bold;
            color: #1a73e8;
            margin-left: 8px;
        }
        
        .answer-space {
            margin-top: 10px;
        }
        
        .answer-line {
            height: 2em;
            border-bottom: 1px solid #999;
            margin: 8px 0;
        }
        
        .buttons {
            text-align: center;
            margin-top: 20px;
        }
        
        .font-large {
            font-size: 20px;
            line-height: 1.8;
        }
        
        .font-large .question-title {
            font-size: 20px;
        }
        
        .font-large .answer-line {
            height: 2.5em;
        }
        
        @media print {
            @page {
                size: A4;
                margin: 15mm;
            }
            
            /* הסרה מוחלטת של כל הגבולות והצבעים */
            * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                border-right: none !important;
                border-left: none !important;
                box-shadow: none !important;
            }
            
            body {
                margin: 0 !important;
                padding: 0 !important;
                background: white !important;
                font-size: 14px !important;
                line-height: 1.4 !important;
            }
            
            .no-print {
                display: none !important;
            }
            
            .worksheet-container {
                box-shadow: none !important;
                margin: 0 !important;
                padding: 0 !important;
                border-radius: 0 !important;
                max-width: none !important;
                width: 100% !important;
            }
            
            .question {
                background-color: white !important;
                border: none !important;
                border-right: none !important;
                break-inside: avoid;
                margin-bottom: 15px !important;
                padding: 5px 0 !important;
                box-shadow: none !important;
            }
            
            .word-bank {
                background-color: white !important;
                border: 1px solid #999 !important;
                border-right: none !important;
                padding: 8px !important;
                margin: 5px 0 !important;
            }
            
            .worksheet-intro {
                background-color: white !important;
                border: 1px solid #999 !important;
                border-right: none !important;
                padding: 10px !important;
                margin-bottom: 15px !important;
            }
            
            .container {
                background: white !important;
                box-shadow: none !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            /* הסתרת אלמנטים מיותרים בהדפסה */
            .buttons, .back-button, button {
                display: none !important;
            }
            
            /* תיקון גדלים להדפסה */
            .worksheet-title {
                font-size: 22px !important;
                margin-bottom: 10px !important;
            }
            
            .question-title {
                font-size: 14px !important;
            }
            
            .answer-line {
                margin: 3px 0 !important;
                border-bottom: 1px solid #000 !important;
            }
        }
        
        .back-button {
            background: linear-gradient(135deg, #6c757d, #495057);
            margin-bottom: 20px;
        }
        
        .back-button:hover {
            background: linear-gradient(135deg, #495057, #6c757d);
        }
    </style>
</head>
<body>
    <div id="form-container" class="container">
        <h1>🎓 מחולל דפי עבודה בעברית</h1>
        
        <div class="instructions">
            <h3>💡 הנחיות שימוש:</h3>
            <ul>
                <li><strong>שאלות פתוחות:</strong> יקבלו שורות למענה</li>
                <li><strong>שאלות רב-ברירה:</strong> יזוהו לפי אפשרויות (א), (ב), (ג), (ד)</li>
                <li><strong>שאלות השלמה:</strong> יזוהו לפי קווים תחתונים _____</li>
                <li><strong>מחסן מילים:</strong> הוסף "מחסן מילים:" ואחריו המילים</li>
                <li><strong>חלוקת שאלות:</strong> הפרד שאלות עם שורה ריקה או מספר שאלות</li>
            </ul>
        </div>
        
        <div class="form-group">
            <label for="title">📝 כותרת הדף:</label>
            <input type="text" id="title" placeholder="לדוגמה: דף עבודה בכדורסל" required>
        </div>
        
        <div class="form-group">
            <label for="student-name">👤 שם התלמיד (אופציונלי):</label>
            <input type="text" id="student-name" placeholder="שם: _____________">
        </div>
        
        <div class="form-group">
            <label for="class-name">🏫 כיתה (אופציונלי):</label>
            <input type="text" id="class-name" placeholder="כיתה: ___________">
        </div>
        
        <div class="form-group">
            <label for="font-size">🔤 גודל גופן:</label>
            <select id="font-size">
                <option value="regular">גופן רגיל</option>
                <option value="large">גופן גדול - לתלמידים מתקשים</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="intro">📖 טקסט מבוא (אופציונלי):</label>
            <textarea id="intro" placeholder="הכנס כאן טקסט מבוא שיופיע לפני השאלות..."></textarea>
        </div>
        
        <div class="form-group">
            <label for="questions">❓ השאלות:</label>
            <textarea id="questions" placeholder="הדבק כאן את השאלות..." required></textarea>
            <div class="example">דוגמאות לשאלות:

השלימו את המשפט בעזרת מחסן המילים:
את _______ הכדורסל המציא _______.
הכדור יוצא מהמגרש – עוצרים את _______.
משחק כדורסל נמשך _______ דקות.
מחסן מילים: משחק | השעון | 40 | ג'יימס ניסמית

מהו חוק 30 השניות במשחק כדורסל?
(א) חוק שאסורו לרוץ בלי כדור
(ב) חוק שאסורו להחזיק בכדור יותר מ-30 שניות
(ג) חוק שמתיר להיות מתחת לסל
(ד) חוק שאומר שהמשחק נמשך 30 שניות

הסבר/י מדוע עוצרים את השעון במהלך משחק הכדורסל.</div>
        </div>
        
        <button onclick="createWorksheet()">✨ צור דף עבודה</button>
        <button type="button" onclick="clearForm()">🗑️ נקה טופס</button>
    </div>
    
    <div id="worksheet-container" class="hidden">
        <div class="buttons no-print">
            <button class="back-button" onclick="goBack()">🔙 חזור לעריכה</button>
            <button onclick="printClean()">🖨️ הדפסה נקייה</button>
            <button onclick="window.print()">🖨️ הדפס רגיל</button>
            <button onclick="downloadWorksheet()">📄 שמור כ-PDF</button>
        </div>
        
        <div id="worksheet-content" class="worksheet-container">
            <!-- כאן יופיע דף העבודה -->
        </div>
    </div>

    <script>
        function processQuestions(text) {
            if (!text) return [];
            
            text = text.trim();
            const questionBlocks = [];
            
            // מפצל לפי שורות ריקות או מספור שאלות
            const lines = text.split('\n');
            let currentBlock = '';
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                // בדיקה אם זו התחלה של שאלה חדשה
                const isNewQuestion = (
                    (line.match(/^שאלה\s+\d+/i) || line.match(/^\d+\./)) ||
                    (i > 0 && lines[i - 1].trim() === '' && line !== '' && currentBlock.trim())
                );
                
                if (isNewQuestion && currentBlock.trim()) {
                    questionBlocks.push(currentBlock.trim());
                    currentBlock = line;
                } else {
                    currentBlock += (currentBlock ? '\n' : '') + line;
                }
            }
            
            if (currentBlock.trim()) {
                questionBlocks.push(currentBlock.trim());
            }
            
            return questionBlocks
                .filter(block => block.length > 0)
                .map((block, index) => processQuestionBlock(block, index + 1));
        }
        
        function processQuestionBlock(block, number) {
            let text = block.replace(/^שאלה\s+\d+\.?|^\d+\./, '').trim();
            
            let wordBank = '';
            
            // חילוץ מחסן מילים
            if (text.includes('מחסן מילים:')) {
                const parts = text.split(/מחסן מילים:/i);
                text = parts[0].trim();
                if (parts.length > 1) {
                    wordBank = parts[1].trim();
                }
            }
            
            // זיהוי סוג השאלה
            let type = 'open';
            let options = [];
            
            // בדיקה לשאלת השלמה
            if (text.includes('_') || /השלימו|השלם|מלא/i.test(text)) {
                type = 'fill-in-blanks';
            }
            // בדיקה לשאלת רב-ברירה
            else if (hasMultipleChoiceOptions(text)) {
                type = 'multiple-choice';
                const extracted = extractMultipleChoiceOptions(text);
                text = extracted.questionText;
                options = extracted.choiceOptions;
            }
            
            return {
                number: number,
                text: text,
                type: type,
                wordBank: wordBank,
                options: options
            };
        }
        
        function hasMultipleChoiceOptions(text) {
            const optionPatterns = [
                /\([א-ת]\)/g,
                /^\s*[א-ת]\)/gm
            ];
            
            let count = 0;
            for (const pattern of optionPatterns) {
                const matches = text.match(pattern);
                if (matches) count += matches.length;
            }
            
            return count >= 2;
        }
        
        function extractMultipleChoiceOptions(text) {
            const lines = text.split('\n');
            const questionLines = [];
            const optionLines = [];
            let foundOptions = false;
            
            for (const line of lines) {
                const trimmed = line.trim();
                
                const isOption = trimmed.match(/^\s*\([א-ת]\)/) || 
                                trimmed.match(/^\s*[א-ת]\)/) ||
                                /\([א-ת]\)/.test(trimmed);
                
                if (isOption) {
                    foundOptions = true;
                    
                    let cleaned = trimmed
                        .replace(/^\s*\([א-ת]\)\s*/, '')
                        .replace(/^\s*[א-ת]\)\s*/, '')
                        .replace(/\([א-ת]\)\s*/, '')
                        .trim();
                    
                    if (cleaned) {
                        optionLines.push(cleaned);
                    }
                } else if (!foundOptions && trimmed) {
                    questionLines.push(trimmed);
                }
            }
            
            return {
                questionText: questionLines.join('\n'),
                choiceOptions: optionLines
            };
        }
        
        function generateQuestionHTML(question) {
            const questionText = question.text.replace(/_+/g, '<span class="blank-line"></span>');
            
            let html = `
                <div class="question">
                    <div class="question-title">שאלה ${question.number}. ${questionText}</div>
            `;
            
            // מחסן מילים
            if (question.wordBank) {
                html += `<div class="word-bank">מחסן מילים: ${formatWordBank(question.wordBank)}</div>`;
            }
            
            // אפשרויות רב-ברירה
            if (question.type === 'multiple-choice' && question.options.length > 0) {
                html += `<div class="options">`;
                const letters = ['א', 'ב', 'ג', 'ד', 'ה', 'ו', 'ז', 'ח', 'ט', 'י'];
                
                for (let i = 0; i < question.options.length; i++) {
                    html += `
                        <div class="option">
                            <span class="option-letter">(${letters[i]})</span>
                            <span>${question.options[i]}</span>
                        </div>
                    `;
                }
                
                html += `</div>`;
            }
            
            // שורות למענה (שאלות פתוחות)
            if (question.type === 'open') {
                html += `<div class="answer-space">`;
                for (let i = 0; i < 4; i++) {
                    html += `<div class="answer-line"></div>`;
                }
                html += `</div>`;
            }
            
            html += `</div>`;
            return html;
        }
        
        function formatWordBank(wordBank) {
            if (wordBank.includes('|')) {
                return wordBank.split('|').map(w => w.trim()).join(' | ');
            } else if (wordBank.includes(',')) {
                return wordBank.split(',').map(w => w.trim()).join(' | ');
            }
            return wordBank;
        }
        
        function createWorksheet() {
            const title = document.getElementById('title').value;
            const studentName = document.getElementById('student-name').value;
            const className = document.getElementById('class-name').value;
            const intro = document.getElementById('intro').value;
            const questions = document.getElementById('questions').value;
            const fontSize = document.getElementById('font-size').value;
            
            if (!title || !questions) {
                alert('אנא מלא את שדות הכותרת והשאלות');
                return;
            }
            
            const processedQuestions = processQuestions(questions);
            
            if (processedQuestions.length === 0) {
                alert('לא נמצאו שאלות תקינות. אנא בדוק את הפורמט');
                return;
            }
            
            const fontClass = fontSize === 'large' ? 'font-large' : '';
            
            let headerInfo = '';
            if (studentName) headerInfo += `<div>שם: ${studentName}</div>`;
            if (className) headerInfo += `<div>כיתה: ${className}</div>`;
            if (headerInfo) headerInfo = `<div style="text-align: right; margin-bottom: 15px; font-size: 14px;">${headerInfo}</div>`;
            
            const worksheetHTML = `
                <div class="${fontClass}">
                    <div class="worksheet-header">
                        <div class="worksheet-title">${title}</div>
                        ${headerInfo}
                    </div>
                    
                    ${intro ? `<div class="worksheet-intro">${intro}</div>` : ''}
                    
                    <div class="questions">
                        ${processedQuestions.map(q => generateQuestionHTML(q)).join('')}
                    </div>
                </div>
            `;
            
            document.getElementById('worksheet-content').innerHTML = worksheetHTML;
            document.getElementById('form-container').classList.add('hidden');
            document.getElementById('worksheet-container').classList.remove('hidden');
        }
        
        function goBack() {
            document.getElementById('form-container').classList.remove('hidden');
            document.getElementById('worksheet-container').classList.add('hidden');
        }
        
        function clearForm() {
            document.getElementById('title').value = '';
            document.getElementById('student-name').value = '';
            document.getElementById('class-name').value = '';
            document.getElementById('intro').value = '';
            document.getElementById('questions').value = '';
            document.getElementById('font-size').value = 'regular';
        }
        
        function downloadWorksheet() {
            // הסתרת הכפתורים לפני ההדפסה
            const buttons = document.querySelector('.buttons');
            buttons.style.display = 'none';
            
            // הדפסה
            window.print();
            
            // החזרת הכפתורים אחרי ההדפסה
            setTimeout(() => {
                buttons.style.display = 'block';
            }, 1000);
        }
        
        // פונקציה נוספת להדפסה נקייה
        function printClean() {
            const printContents = document.getElementById('worksheet-content').innerHTML;
            
            // יצירת חלון הדפסה נקי לחלוטין
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html lang="he" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <title>דף עבודה</title>
                    <style>
                        @page {
                            size: A4;
                            margin: 20mm;
                        }
                        
                        body {
                            font-family: 'David', 'Arial Hebrew', Arial, sans-serif;
                            direction: rtl;
                            margin: 0;
                            padding: 0;
                            font-size: 14px;
                            line-height: 1.5;
                            color: black;
                            background: white;
                        }
                        
                        .worksheet-header {
                            text-align: center;
                            margin-bottom: 20px;
                            border-bottom: 1px solid #000;
                            padding-bottom: 10px;
                        }
                        
                        .worksheet-title {
                            font-size: 24px;
                            font-weight: bold;
                            margin-bottom: 10px;
                        }
                        
                        .question {
                            margin-bottom: 20px;
                            padding: 0;
                            break-inside: avoid;
                        }
                        
                        .question-title {
                            font-weight: bold;
                            margin-bottom: 8px;
                        }
                        
                        .word-bank {
                            background-color: #f5f5f5;
                            border: 1px solid #ccc;
                            padding: 8px;
                            margin: 8px 0;
                            font-weight: bold;
                        }
                        
                        .worksheet-intro {
                            background-color: #f5f5f5;
                            border: 1px solid #ccc;
                            padding: 10px;
                            margin-bottom: 15px;
                        }
                        
                        .options {
                            margin-top: 5px;
                        }
                        
                        .option {
                            margin-bottom: 5px;
                        }
                        
                        .option-letter {
                            font-weight: bold;
                            margin-left: 8px;
                        }
                        
                        .answer-line {
                            height: 1.5em;
                            border-bottom: 1px solid #000;
                            margin: 8px 0;
                        }
                        
                        .blank-line {
                            display: inline-block;
                            min-width: 100px;
                            height: 1px;
                            border-bottom: 1px solid #000;
                            margin: 0 5px;
                        }
                    </style>
                </head>
                <body>
                    ${printContents}
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.focus();
            
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 250);
        }
    </script>
</body>
</html>